<!DOCTYPE html>
<html>
<head>
    <title>Book Manager</title>
</head>
<body>
    <h1>Book Manager</h1>

    {% if messages %}
        {% for message in messages %}
            <div style="padding: 10px; margin: 10px 0; border: 1px solid #ccc;">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">

        <!-- Добавить книгу -->
        <div>
            <h3>Добавить книгу</h3>
            <form method="post">
                {% csrf_token %}
                <input type="text" name="title" placeholder="Название" required style="width: 100%; margin: 5px 0; padding: 5px;"><br>
                <input type="text" name="author" placeholder="Автор" required style="width: 100%; margin: 5px 0; padding: 5px;"><br>
                <input type="number" name="year" placeholder="Год" required style="width: 100%; margin: 5px 0; padding: 5px;"><br>
                <button type="submit" style="width: 100%; padding: 8px;">Добавить</button>
            </form>

            <h3>Экспорт книг</h3>
            <form method="post">
                {% csrf_token %}
                <button type="submit" name="export" style="width: 100%; padding: 8px;">
                    Экспорт в JSON ({{ books.count }})
                </button>
            </form>

            <h3>Загрузить JSON</h3>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="json_file" accept=".json" required style="width: 100%; margin: 5px 0;">
                <button type="submit" style="width: 100%; padding: 8px;">Загрузить</button>
            </form>
        </div>

        <!-- Список книг -->
        <div>
            <h3>Список книг ({{ books.count }})</h3>
            {% if books %}
                {% for book in books %}
                    <div style="border-bottom: 1px solid #eee; padding: 5px 0;">
                        <strong>{{ book.title }}</strong><br>
                        {{ book.author }} ({{ book.year }})
                    </div>
                {% endfor %}
            {% else %}
                <p>Книг нет</p>
            {% endif %}
        </div>

        <!-- JSON файлы -->
        <div>
            <h3>JSON файлы ({{ json_files|length }})</h3>
            {% if json_files %} <!-- Проверка если файлы существуют-->
                {% for file in json_files %}
                    <div style="border-bottom: 1px solid #eee; padding: 5px 0;">
                        <a href="{% url 'view_json' file.name %}">{{ file.name }}</a><br>
                        <small>{{ file.size }} bytes</small>
                    </div>
                {% endfor %}
            {% else %}
                <p>Файлов нет</p>
            {% endif %}
        </div>

    </div>
</body>
</html>